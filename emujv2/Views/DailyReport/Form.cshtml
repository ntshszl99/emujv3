@{
    ViewBag.Title = "Daily Form";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="app-content main-content">
    <div class="side-app">
        <div class="container-fluid main-container">

            <!--Page header-->
            <div class="page-header">
                <div class="page-leftheader">
                    <h4 class="page-title">Update Form</h4>
                </div>
                @*<div class="page-rightheader ms-auto d-lg-flex d-none">
                    <ol class="breadcrumb">
                        <li></li>
                        <li class="breadcrumb-item"><a href="/DailyReport/R1Form"><span class="breadcrumb-icon">R1 Form</span></a></li>
                        <li class="breadcrumb-item active font-weight-bold" aria-current="page">Update Form</li>
                        <li class="breadcrumb-item"><a href="/DailyReport/Report"><span class="breadcrumb-icon">Report</span></a></li>
                        <li class="breadcrumb-item"><a href="/DailyReport/Checklist"><span class="breadcrumb-icon">Checklist</span></a></li>
                    </ol>
                </div>*@
            </div>
            <!--End Page header-->

            <div class="" id="tempekList">
                <div class="card">
                    <div class="card-body">
                        <div class="mb-3 m-0">
                            <div class="row">
                                <div class="col-6">
                                    <label class="mt-3 form-label">Region</label>
                                    <select id="region" class="form-control form-select select2">
                                        <option value="-0">Select Region</option>
                                    </select>
                                </div>
                                <div class="col-6">
                                    <label class="mt-3 form-label">KMUJ</label>
                                    <select id="kmuj" class="form-control form-select select2">
                                        <option value="-0">Select KMUJ</option>
                                    </select>
                                </div>
                                <div class="col-6">
                                    <label class="mt-3 form-label">Section</label>
                                    <select id="section" class="form-control form-select select2">
                                        <option value="-0">Select Section</option>
                                    </select>
                                </div>
                                <div class="col-6">
                                    <label class="mt-3 form-label">Gang</label>
                                    <select id="gang" class="form-control form-select select2">
                                        <option value="-0">Select Gang</option>
                                    </select>
                                </div>
                                <div class="col-6">
                                    <label class="mt-3 form-label">Date (From - To)</label>
                                    <div class="input-group">
                                        <div class="input-group-append">
                                            <span class="input-group-text"><i class=" mt-1 mb-1 fa fa-solid fa fa-calendar font-20"></i></span>
                                        </div>
                                        <input type="text" class="form-control" id="txtDate" name="txtDate" required="required" autocomplete="off" />
                                    </div>
                                </div>
                                <div class="col-2">
                                    <label class="mt-3 form-label">.</label>
                                    <button type="button" name="Cari" id="Cari" class="btn btn-purple waves-effect waves-light"><i class="fa fa-search"></i></button>
                                </div>
                                <div class="card-body">
                                    <div class="col-lg-12">
                                        <div class="table-responsive table-lg">
                                            <table id="tableRep" class="table card-table table-vcenter text-nowrap border">
                                                <thead>
                                                </thead>
                                                <tbody></tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!--Modal User Details-->
            <div class="modal" id="modalDetails">
                <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">Staff Details</h5><button aria-label="Close" class="btn-close" data-bs-dismiss="modal" type="button"><span aria-hidden="true">&times;</span></button>
                        </div>
                        <div class="modal-body">
                            <div class="card-body">
                                <div class="mb-0 m-0">
                                    <div class="row">
                                        <div class="col-12">
                                            <div class="form-label">Staff ID</div>
                                            <input readonly id="staffID" type="text" class="form-control">
                                        </div>
                                        <div class="col-12">
                                            <div class="mt-5 form-label">Staff Name</div>
                                            <input readonly id="staffname" type="text" class="form-control">
                                        </div>
                                        <div class="col-12">
                                            <div class="mt-5 form-label">Department</div>
                                            <input readonly id="dept" type="text" class="form-control">
                                        </div>
                                        <div class="col-12">
                                            <div class="mt-5 form-label">Designation</div>
                                            <input readonly id="position" type="text" class="form-control">
                                        </div>
                                        <div class="mb-5"></div>
                                        <div class="card-body bg-success-transparent-2">
                                            <div class="mb-0 m-0">
                                                <div class="row">
                                                    <div class="col-12">
                                                        <div class="mt-2 form-label">Update Status</div>
                                                        <select id="cuti" class="form-control form-select select2" required="required">
                                                            <option value="-0">.: Select Reason :.</option>
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="modal-footer pd-20">
                                    <button class="btn btn-success" type="button">Update</button> <button class="btn btn-light" data-bs-dismiss="modal" ria-label="Close" type="button">Cancel</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!--Modal Delete User-->
            <div class="modal" id="modalDelete">
                <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">Delete Staff</h5><button aria-label="Close" class="btn-close" data-bs-dismiss="modal" type="button"><span aria-hidden="true">&times;</span></button>
                        </div>
                        <div class="modal-body">
                            <div class="card-body">
                                <div class="mb-0 m-0">
                                    <div class="row">
                                        <div class="col-12 bg-danger-transparent-2">
                                            <h5 class="mt-5 mb-5 text-danger text-center">Are you sure want to delete?</h5>
                                        </div>
                                        <div class="col-12">
                                            <div class="mt-5 form-label">Staff ID</div>
                                            <input readonly id="staffID2" type="text" class="form-control">
                                        </div>
                                        <div class="col-12">
                                            <div class="mt-5 form-label">Staff Name</div>
                                            <input readonly id="staffname2" type="text" class="form-control">
                                        </div>
                                        <div class="col-12">
                                            <div class="mt-5 form-label">Department</div>
                                            <input readonly id="dept2" type="text" class="form-control">
                                        </div>
                                        <div class="col-12">
                                            <div class="mt-5 form-label">Designation</div>
                                            <input readonly id="position2" type="text" class="form-control">
                                        </div>
                                        <div class="mb-5"></div>
                                    </div>
                                </div>
                                <div class="modal-footer pd-20">
                                    <button class="btn btn-danger" type="button">Delete</button> <button class="btn btn-light" data-bs-dismiss="modal" ria-label="Close" type="button">Cancel</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


@section scripts{

    <script src="~/assets/scripts/dashboard.js"></script>
    <script src="~/assets/plugins/daterangepicker/daterangepicker.js"></script>
    <script src="~/assets/plugins/select2/select2.min.js"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            checkSess();
            listRegion();
            listKMUJ();
            listSection();
            listGang();

            //$(function () {
            //    $("#datepicker").datepicker();
            //});

            //$(function () {
            //    $("#datepicker2").datepicker();
            //});


            //$("#datepicker, #datepicker2").on('change', function() {

            //    console.log(start.format('YYYY/MM/DD'));
            //    console.log(end.format('YYYY/MM/DD'));

            //    sdate = start.format('YYYY/MM/DD');
            //    edate = end.format('YYYY/MM/DD');
            //    localStorage.setItem("selHar", sdate);
            //    localStorage.setItem("selHarE", edate);

            //    rgn = $("#region option:selected").text();
            //    localStorage.setItem("selRgn", rgn, this.value);

            //    kmj = $("#kmuj option:selected").text();
            //    localStorage.setItem("selKmj", kmj, this.value);

            //    scn = $("#section option:selected").text();
            //    localStorage.setItem("selScn", scn, this.value);

            //    listReports(localStorage.getItem("selRgn", this.value), localStorage.getItem("selKmj", this.value), localStorage.getItem("selScn", this.value), sdate, edate);
            //   /* listReports(localStorage.getItem("selRgn", this.value), sdate, edate);*/
            //    salertSave('Update Date : ' + start.format('YYYY/MM/DD') + ' - ' + end.format('YYYY/MM/DD'));

            //});



            $('#txtDate').daterangepicker({

                opens: 'center',
                minYear: 2021,
                maxSpan: {
                    days: 30
                },
            }, function (start, end, label) {
                console.log("A new date selection was made: " + start.format('YYYY/MM/DD') + ' to ' + end.format('YYYY/MM/DD'));
                console.log(start.format('YYYY/MM/DD') + ' - ' + end.format('YYYY/MM/DD'));

                sdate = start.format('YYYY/MM/DD');
                edate = end.format('YYYY/MM/DD');
                localStorage.setItem("selHar", sdate);
                localStorage.setItem("selHarE", edate);

                rgn = $("#region option:selected").text();
                localStorage.setItem("selRgn", rgn, this.value);

                kmj = $("#kmuj option:selected").text();
                localStorage.setItem("selKmj", kmj, this.value);

                scn = $("#section option:selected").text();
                localStorage.setItem("selScn", scn, this.value);

                listReports(localStorage.getItem("selRgn", this.value), localStorage.getItem("selKmj", this.value), localStorage.getItem("selScn", this.value), sdate, edate);
                //listReports(localStorage.getItem("selRgn", this.value), sdate, edate);
                salertSave('Update Date : ' + start.format('YYYY/MM/DD') + ' - ' + end.format('YYYY/MM/DD'));
            });

            $("#gang, #kmuj, #section, sdate, edate").on('change', function () {

                checkStore();

                var sdate = localStorage.setItem("selHar", sdate);
                var edate = localStorage.setItem("selHarE", edate);

                rgn = $("#region option:selected").text();
                localStorage.setItem("selRgn", rgn, this.value);

                kmj = $("#kmuj option:selected").text();
                localStorage.setItem("selKmj", kmj, this.value);

                scn = $("#section option:selected").text();
                localStorage.setItem("selScn", scn, this.value);

                listReports(localStorage.getItem("selRgn", this.value), localStorage.getItem("selKmj", this.value), localStorage.getItem("selScn", this.value), sdate, edate);
                //listReports(localStorage.getItem("selRgn", this.value), localStorage.getItem("selKmj", this.value), localStorage.getItem("selScn", this.value));

            });

        });

        //$(document).on('click', '.delete', function () {
        //    var codeid = $(this).attr('id');
        //    $.ajax({
        //        type: 'GET',
        //        url: "process/daily_delete.php",
        //        data: { codeid: codeid },
        //        cache: false,
        //        success: function (data) {
        //            if (data) {
        //                location.reload(true);
        //                $("#1stgrade7").fadeOut("slow");
        //            } else {
        //                return false;
        //            }
        //        }
        //    });
        //});

        function listGang() {
            $.ajax({
                url: linkDepan + "GangList",
                dataType: "json",
                beforeSend: function (request) {
                    request.setRequestHeader("Token", localStorage.getItem('main'));
                },
                success: function (data) {
                    if (data.length >= 1) {
                        auxArr = [];
                        $.each(data, function (index, value) {
                            auxArr[index] = "<option value='" + value.id + "'>" + value.gang + "</option>";
                        });
                        $('#gang').append(auxArr.join(''));
                    } else {
                        $("#gang").addClass(" is-invalid");

                    }
                },
                error: function (xhr) {
                    swarning();
                },
                complete: function () {
                }
            });
        }

        function listRegion() {
            $.ajax({
                url: linkDepan + "GetRegionList",
                dataType: "json",
                beforeSend: function (request) {
                    request.setRequestHeader("Token", localStorage.getItem('main'));
                },
                success: function (data) {
                    if (data.length >= 1) {
                        auxArr = [];
                        $.each(data, function (index, value) {
                            auxArr[index] = "<option value='" + value.region_id + "'>" + value.region_name + "</option>";
                        });
                        $('#region').append(auxArr.join(''));
                    } else {
                        $("#region").addClass(" is-invalid");

                    }
                },
                error: function (xhr) {
                    swarning();
                },
                complete: function () {
                }
            });
        }

        function listSection() {
            $.ajax({
                url: linkDepan + "GetSectionList",
                dataType: "json",
                beforeSend: function (request) {
                    request.setRequestHeader("Token", localStorage.getItem('main'));
                },
                success: function (data) {
                    if (data.length >= 1) {
                        auxArr = [];
                        $.each(data, function (index, value) {
                            auxArr[index] = "<option value='" + value.section_id + "'>" + value.section_name + "</option>";
                        });
                        $('#section').append(auxArr.join(''));
                    } else {
                        $("#section").addClass(" is-invalid");

                    }
                },
                error: function (xhr) {
                    swarning();
                },
                complete: function () {
                }
            });
        }

        function listKMUJ() {
            $.ajax({
                url: linkDepan + "KMUJList",
                dataType: "json",
                beforeSend: function (request) {
                    request.setRequestHeader("Token", localStorage.getItem('main'));
                },
                success: function (data) {
                    if (data.length >= 1) {
                        auxArr = [];
                        $.each(data, function (index, value) {
                            auxArr[index] = "<option value='" + value.muj + "'>" + value.kmuj_name + "</option>";
                        });
                        $('#kmuj').append(auxArr.join(''));
                    } else {
                        $("#kmuj").addClass(" is-invalid");

                    }
                },
                error: function (xhr) {
                    swarning();
                },
                complete: function () {
                }
            });
        }

        function listReports(region, kmuj, section, mdate, edate) {
            if (mdate === undefined) {
                var arrBuln = ['JAN', 'FEB', 'MAR', 'APR', 'MAY', '06', 'JUL', 'AUG', 'SEP', 'OCT', 'NOV', 'DEC'];
                var d = new Date();
                var month = d.getMonth() - 1;
                mdate = d.getDate() + '/' + arrBuln[month] + '/' + d.getFullYear();
                localStorage.setItem("selHar", mdate);
                localStorage.setItem("selRgn", rgn, this.value);
                localStorage.setItem("selKmj", kmj, this.value);
                localStorage.setItem("selScn", scn, this.value);
            }
            if (edate === undefined) {
                var arrBuln = ['JAN', 'FEB', 'MAR', 'APR', 'MAY', '06', 'JUL', 'AUG', 'SEP', 'OCT', 'NOV', 'DEC'];
                var d = new Date();
                var month = d.getMonth();
                edate = d.getDate() + '/' + arrBuln[month] + '/' + d.getFullYear(); console.log(edate);
                localStorage.setItem("selHarE", edate);
                localStorage.setItem("selRgn", rgn, this.value);
                localStorage.setItem("selKmj", kmj, this.value);
                localStorage.setItem("selScn", scn, this.value);
            }
            $.ajax({
                url: linkDepan + "GetDailyReport?Region=" + region + "&Kmuj=" + kmuj + "&Section=" + section + "&SDate=" + mdate + "&Edate=" + edate,
                /*url: linkDepan + "GetDailyReport?Region=" + region + "&Kmuj=" + kmuj + "&Section=" + section,*/
                type: 'GET',
                dataType: 'json',
                data: {},
                beforeSend: function (request) {
                    request.setRequestHeader("Token", localStorage.getItem('main'));
                },
                success: function (data) {
                    console.log('mana : ' + data);
                    var counter = 1;
                    $.fn.dataTable.ext.errMode = 'throw';
                    if ($.fn.dataTable.isDataTable('#tableRep')) {
                        $('#tableRep').DataTable().destroy();
                    }
                    $('#tableRep').DataTable({
                        dom: 'Bfrtip',
                        buttons: [
                            'copy', 'csv', 'excel', 'pdf', 'print'
                        ],
                        responsive: true,
                        data: data,
                        columns: [
                            { data: "no" },
                            { data: "region_name" },
                            { data: "kmuj_name" },
                            { data: "section_name" },
                            { data: "Gang" },
                            { data: "daily_date" },
                            { data: "daily_worktype" },
                            { data: "output" },
                            { data: "effect_kmfrom" },
                            { data: "effect_kmto" },
                            { data: "daily_condition" },
                            { data: "daily_workers" },
                            { data: "daily_category" },
                            { data: "Time" },
                            { data: "daily_additional" },
                            { data: "rpt_code" },
                        ],
                        columnDefs: [
                            {
                                targets: 1,
                                title: "Code",
                                render: function (data, type, full, meta) {
                                    return data;
                                },
                            },
                            {
                                targets: -2,
                                title: "Additional Note",
                                render: function (data, type, full, meta) {
                                    return data;
                                },
                            },
                            {
                                targets: -3,
                                title: "Time (Start-End)",
                                render: function (data, type, full, meta) {
                                    return data;
                                },
                            },
                            {
                                targets: -4,
                                title: "Category",
                                render: function (data, type, full, meta) {
                                    return data;
                                },
                            },
                            {
                                targets: -5,
                                title: "Workers",
                                render: function (data, type, full, meta) {
                                    return data;
                                },
                            },
                            {
                                targets: -6,
                                title: "Up/Dn",
                                render: function (data, type, full, meta) {
                                    return data;
                                },
                            },
                            {
                                targets: -7,
                                title: "To (KM)",
                                render: function (data, type, full, meta) {
                                    return data;
                                },
                            },
                            {
                                targets: -8,
                                title: "From (KM)",
                                render: function (data, type, full, meta) {
                                    return data;
                                },
                            },
                            {
                                targets: -9,
                                title: "Output/Unit",
                                render: function (data, type, full, meta) {
                                    return data;
                                },
                            },
                            {
                                targets: -10,
                                title: "Work Type",
                                render: function (data, type, full, meta) {
                                    return data;
                                },
                            },
                            {
                                targets: -11,
                                title: "Date",
                                render: function (data, type, full, meta) {
                                    return data;
                                },
                            },
                            {
                                targets: -12,
                                title: "Gang",
                                render: function (data, type, full, meta) {
                                    return data;
                                },
                            },
                            {
                                targets: -13,
                                title: "MUJ",
                                render: function (data, type, full, meta) {
                                    return data;
                                },
                            },
                            {
                                targets: -14,
                                title: "KMUJ",
                                render: function (data, type, full, meta) {
                                    return data;
                                },
                            },
                            {
                                targets: -15,
                                title: "Region",
                                render: function (data, type, full, meta) {
                                    return data;
                                },
                            },
                            {
                                targets: -16,
                                title: "No",
                                render: function (data, type, full, meta) {
                                    return counter++;
                                },
                            }]

                    });
                },
                error: function (xhr) {
                    swarning();
                },
                complete: function () {
                }
            });
        }

    </script>
}







